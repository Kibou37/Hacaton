import { BodyAnalysis, ClothingRecommendation, Recommendations } from '../types';

/**
 * Генерирует рекомендации по одежде на основе анализа фигуры
 */
export function generateRecommendations(analysis: BodyAnalysis): Recommendations {
  const clothing = getClothingRecommendations(analysis);
  
  return {
    bodyAnalysis: analysis,
    clothing
  };
}

function getClothingRecommendations(analysis: BodyAnalysis): ClothingRecommendation {
  const { bodyType, colorType, gender } = analysis;
  
  // Рекомендации для мужчин
  if (gender === 'male') {
    return getMaleRecommendations(bodyType, colorType);
  }
  
  // Рекомендации для женщин
  return getFemaleRecommendations(bodyType, colorType);
}

function getMaleRecommendations(bodyType: BodyAnalysis['bodyType'], colorType: BodyAnalysis['colorType']): ClothingRecommendation {
  const recommendations: Record<BodyAnalysis['bodyType'], ClothingRecommendation> = {
    rectangle: {
      clothingTypes: [
        'Классические рубашки с прямым кроем',
        'Пиджаки и блейзеры стандартного покроя',
        'Прямые брюки и джинсы',
        'Свитеры и кардиганы прямого силуэта'
      ],
      silhouettes: [
        'Прямой силуэт',
        'Классический крой',
        'Стандартный покрой'
      ],
      shoulderLength: 'Рукава стандартной длины, подходящие по размеру',
      waistLength: 'Средняя посадка брюк, классический пояс',
      colorPalette: [],
      tips: [
        'Выбирайте одежду стандартного покроя',
        'Избегайте слишком обтягивающей или мешковатой одежды',
        'Классический стиль подчеркнет вашу фигуру'
      ]
    },
    'inverted-triangle': {
      clothingTypes: [
        'Рубашки с V-образным вырезом',
        'Пиджаки с мягкими плечами',
        'Брюки с прямым или слегка расклешенным кроем',
        'Светлые низы, темные верхи для баланса'
      ],
      silhouettes: [
        'Приталенный верх, свободный низ',
        'Классический крой с акцентом на низ',
        'Прямой силуэт'
      ],
      shoulderLength: 'Рукава стандартной длины без дополнительных деталей',
      waistLength: 'Средняя посадка брюк',
      colorPalette: [],
      tips: [
        'Балансируйте пропорции: строгий верх, более объемный низ',
        'Используйте темные цвета для верха',
        'Избегайте объемных плеч и деталей на груди'
      ]
    },
    triangle: {
      clothingTypes: [
        'Рубашки с деталями на плечах (погоны)',
        'Пиджаки с подплечниками',
        'Брюки прямого кроя',
        'Темные низы, светлые верхи'
      ],
      silhouettes: [
        'Приталенный верх, прямой низ',
        'Классический крой с акцентом на верх',
        'Прямой силуэт'
      ],
      shoulderLength: 'Рукава с деталями для создания объема в плечах',
      waistLength: 'Средняя посадка брюк',
      colorPalette: [],
      tips: [
        'Балансируйте пропорции: объемный верх, строгий низ',
        'Используйте темные цвета для низа',
        'Акцентируйте внимание на верхней части тела'
      ]
    },
    apple: {
      clothingTypes: [
        'Рубашки с V-образным вырезом',
        'Пиджаки прямого кроя',
        'Брюки с завышенной талией',
        'Свободные свитеры и кардиганы'
      ],
      silhouettes: [
        'Прямой силуэт',
        'Классический крой',
        'Свободный покрой'
      ],
      shoulderLength: 'Рукава стандартной длины',
      waistLength: 'Завышенная талия, избегайте низкой посадки',
      colorPalette: [],
      tips: [
        'Избегайте обтягивающей одежды в области талии',
        'Используйте вертикальные линии и принты',
        'Выбирайте одежду прямого кроя'
      ]
    },
    hourglass: {
      clothingTypes: [
        'Приталенные рубашки',
        'Пиджаки с акцентом на талии',
        'Брюки классического кроя',
        'Ремни для подчеркивания талии'
      ],
      silhouettes: [
        'Приталенный силуэт',
        'Классический крой',
        'Прямой силуэт с акцентом на талии'
      ],
      shoulderLength: 'Рукава стандартной длины',
      waistLength: 'Подчеркивайте талию поясом',
      colorPalette: [],
      tips: [
        'Используйте ремни для подчеркивания талии',
        'Избегайте мешковатой одежды',
        'Выбирайте приталенную одежду'
      ]
    }
  };
  
  const baseRecommendation = recommendations[bodyType];
  baseRecommendation.colorPalette = getColorPalette(colorType);
  
  return baseRecommendation;
}

function getFemaleRecommendations(bodyType: BodyAnalysis['bodyType'], colorType: BodyAnalysis['colorType']): ClothingRecommendation {
  const recommendations: Record<BodyAnalysis['bodyType'], ClothingRecommendation> = {
    hourglass: {
      clothingTypes: [
        'Приталенные платья и блузки',
        'Поясные ремни для подчеркивания талии',
        'V-образные и круглые вырезы',
        'Юбки-карандаш и А-силуэт'
      ],
      silhouettes: [
        'Приталенный силуэт',
        'A-силуэт',
        'Прямой силуэт с акцентом на талии'
      ],
      shoulderLength: 'Любая длина, но предпочтительно 3/4 или короткий рукав',
      waistLength: 'Подчеркивайте талию поясом или приталенным кроем',
      colorPalette: [],
      tips: [
        'Используйте пояса для подчеркивания талии',
        'Избегайте мешковатой одежды',
        'Выбирайте одежду, которая следует линиям вашего тела'
      ]
    },
    rectangle: {
      clothingTypes: [
        'Одежда с деталями на груди и бедрах',
        'Платья с баской',
        'Блузки с воланами и рюшами',
        'Юбки с карманами и складками'
      ],
      silhouettes: [
        'A-силуэт',
        'Трапеция',
        'Одежда с акцентами на плечах и бедрах'
      ],
      shoulderLength: 'Рукава с деталями (буфы, воланы) для создания объема',
      waistLength: 'Используйте пояса и баски для создания талии',
      colorPalette: [],
      tips: [
        'Создавайте иллюзию талии с помощью поясов',
        'Добавляйте объем в области груди и бедер',
        'Избегайте прямых мешковатых силуэтов'
      ]
    },
    triangle: {
      clothingTypes: [
        'Блузки с широкими плечами (погоны, воланы)',
        'Платья с открытыми плечами',
        'Юбки прямого или слегка расклешенного кроя',
        'Темные низы, светлые верхи'
      ],
      silhouettes: [
        'A-силуэт',
        'Трапеция',
        'Приталенный верх, свободный низ'
      ],
      shoulderLength: 'Короткие рукава или рукава 3/4 с деталями',
      waistLength: 'Средняя посадка, избегайте низкой посадки',
      colorPalette: [],
      tips: [
        'Балансируйте пропорции: объемный верх, строгий низ',
        'Используйте темные цвета для низа',
        'Акцентируйте внимание на верхней части тела'
      ]
    },
    'inverted-triangle': {
      clothingTypes: [
        'Платья и блузки с V-образным вырезом',
        'Юбки А-силуэт и расклешенные',
        'Одежда с акцентами на бедрах',
        'Светлые низы, темные верхи'
      ],
      silhouettes: [
        'A-силуэт',
        'Приталенный верх, объемный низ',
        'Трапеция'
      ],
      shoulderLength: 'Минималистичные рукава без деталей',
      waistLength: 'Средняя или высокая посадка для баланса',
      colorPalette: [],
      tips: [
        'Балансируйте пропорции: строгий верх, объемный низ',
        'Используйте темные цвета для верха',
        'Добавляйте детали и объем в области бедер'
      ]
    },
    apple: {
      clothingTypes: [
        'Платья и блузки с V-образным вырезом',
        'Одежда с завышенной талией',
        'Прямые и А-силуэт платья',
        'Свободные блузки и туники'
      ],
      silhouettes: [
        'A-силуэт',
        'Прямой силуэт',
        'Трапеция'
      ],
      shoulderLength: 'Рукава 3/4 или длинные, избегайте коротких',
      waistLength: 'Завышенная талия, избегайте пояса на талии',
      colorPalette: [],
      tips: [
        'Избегайте обтягивающей одежды в области талии',
        'Используйте вертикальные линии и принты',
        'Акцентируйте внимание на ногах и декольте'
      ]
    }
  };
  
  const baseRecommendation = recommendations[bodyType];
  baseRecommendation.colorPalette = getColorPalette(colorType);
  
  return baseRecommendation;
}

/**
 * Возвращает цветовую палитру для цветотипа
 */
function getColorPalette(colorType: BodyAnalysis['colorType']): string[] {
  const palettes: Record<BodyAnalysis['colorType'], string[]> = {
    spring: [
      '#FFE5B4', // Персиковый
      '#FFD700', // Золотистый
      '#FFA07A', // Светло-лососевый
      '#98FB98', // Бледно-зеленый
      '#87CEEB', // Небесно-голубой
      '#FFB6C1', // Светло-розовый
      '#F0E68C', // Хаки
      '#FFEFD5'  // Папайя
    ],
    summer: [
      '#E6E6FA', // Лавандовый
      '#B0E0E6', // Пороховой голубой
      '#FFB6C1', // Розовый
      '#DDA0DD', // Сливовый
      '#F0F8FF', // Алиса синий
      '#E0E0E0', // Светло-серый
      '#C8A2C8', // Сиреневый
      '#AFEEEE'  // Бледно-бирюзовый
    ],
    autumn: [
      '#8B4513', // Коричневый
      '#CD853F', // Перу
      '#A0522D', // Сиена
      '#D2691E', // Шоколадный
      '#B8860B', // Темно-золотой
      '#8B7355', // Бежевый
      '#A0522D', // Сиена
      '#D2B48C'  // Загар
    ],
    winter: [
      '#000080', // Темно-синий
      '#8B0000', // Темно-красный
      '#2F4F4F', // Темно-серый
      '#191970', // Полуночно-синий
      '#800080', // Фиолетовый
      '#000000', // Черный
      '#FFFFFF', // Белый
      '#FF1493'  // Глубокий розовый
    ]
  };
  
  return palettes[colorType];
}
